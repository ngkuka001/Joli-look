$(document).keyup(function(e){if(e.keyCode==27){$('.open').removeClass('open');$('html').removeClass('nooverflow');}});$(window).resize(function(){});window.bl_cart={lang:$("html").attr('class'),t:function(text){var t_text=text;if(window.bl_cart.lang=="fr"){switch(text){case"The coupon entered is unknown.":t_text="Le coupon spécifié n'est pas connu.";break;case"The coupon entered has expired.":t_text="Le coupon spécifié est expiré.";break;case"The coupon entered has already been used.":t_text="Le coupon spécifié a déjà été réclamé.";break;case"The coupon entered is invalid.":t_text="Le coupon spécifié n'est pas valide.";break;}}
return t_text;},init:function(){var existingCoupon=$('a.remove-coupon-code').attr('data-code');if(existingCoupon===undefined||existingCoupon===false||existingCoupon===''){$('.add-new-coupon-section').show();$('.remove-new-coupon-section').hide();}else{$('.add-new-coupon-section').hide();$('.remove-new-coupon-section').show();}
window.bl_cart.checkCartNotification();$('#cart-desktop_link').on('click',function(){window.bl_cart.isCartEmpty();});$('#shopping-cart').on('click','a.bag-remove',function(){var cart_id=$(this).attr('data-cart-id');window.bl_cart.removeFromCart(cart_id);window.gtm_analytics.removeFromCart();});$('#shopping-cart').on('click','#add-upsell-to-cart',function(e){var id=$(this).attr('data-cart-upsell-id');window.bl_cart.addUpsellToCart(id,'VT','NA','NA');window.gtm_analytics.addToCart();});$('#shopping-cart').on('click','a img.cart-preview',function(){var is_glasses=$(this).parent().attr('data-cart-is-glasses');var gender=$(this).parent().attr('data-cart-gender').toLowerCase();var type=$(this).parent().attr('data-cart-type').toLowerCase();var color=$(this).parent().attr('data-cart-color').toLowerCase();type=type.replace("'",'');type=type.split(' ').join('-');type=type.replace('&','and');color=color.split(' ').join('-');var myURL='';if(is_glasses==1){myURL='/eyeglasses/'+gender+'/'+type+'/'+color;}else{myURL='/sunglasses/'+gender+'/'+type+'/'+color;}
window.bl_cart.productClickedCart(myURL);});$('#shopping-cart').on('click','#continue_shopping',function(){$('.open').removeClass('open');$('html').removeClass('nooverflow');});$("body").on("click","#apply-coupon-code",function(){window.bl_cart.applyCouponCode($('#couponcode').val());window.gtm_analytics.couponApplied();});$('#couponcode').keydown(function(e){if(e.keyCode==13){window.bl_cart.applyCouponCode($('#couponcode').val());window.gtm_analytics.couponApplied();}});$("body").on("click","a.remove-coupon-code",function(e){e.preventDefault();window.bl_cart.removeCouponCode();});$("body").on("click",".button-apply-mobile",function(){window.bl_cart.applyCouponCode($('#promocode').val());window.gtm_analytics.couponApplied();});if(window.location.pathname=="/cart"){window.gtm_analytics.cartDisplayed();}
window.bl_cart.clickedForHelp();},clickedForHelp:function(){$('.need-help-mobile, .footer.need-help').on('click','.need-help-intro',function(e){$(this).addClass('hide');$('.need-help-info').removeClass('hide');window.gtm_analytics.requestHelp();});$('.need-help-mobile, .footer.need-help').on('click','li',function(e){$('.need-help-mobile, .footer.need-help').addClass('hide');$('.need-help-info').addClass('hide');$('.need-help-intro').removeClass('hide');});},checkCartNotification:function(){$('#bag-items .cart-notification').css('display','none');$('#bag-items p').each(function(index){var pre_order=$(this);if($(pre_order).hasClass('pre-order-text')){var pre_order_text=$(pre_order).text();if(pre_order_text.length>0){$('#bag-items .cart-notification').css('display','block');}}});},isCartEmpty:function(){var url='/bl_ajax/is-cart-empty';$.getJSON(url,function(data){if(data==0){$('#checkout').addClass("disabled");if(window.location.pathname=="/checkout"){window.location.replace("/");}}});},applyCouponCode:function(code){var url='/bl_ajax/add-coupon-code/'+code;window.bl_pulser.pulsateElement($('#code'));$.getJSON(url,function(data){if(data.coupon_info==false){$('.coupon-apply').hide();$('.coupon-validation-section').html(window.bl_cart.t('The coupon entered is unknown.'));}else{switch(data.coupon_info.state){case"Expired":$('.coupon-validation-section').html(window.bl_cart.t('The coupon entered has expired.'));$('#couponcode').focus();break;case"Used":$('.coupon-validation-section').html(window.bl_cart.t('The coupon entered has already been used.'));$('#couponcode').focus();break;case"Invalid":$('.coupon-validation-section').html(window.bl_cart.t('The coupon entered is invalid.'));$('#couponcode').focus();break;case"Active":$('.add-new-coupon-section').hide();$('.remove-new-coupon-section').show();$('.coupon-validation-section').html('');$('.coupon-apply').fadeIn(200);$('#subtotal').html('$'+parseFloat(data.cart_info.total_items).toFixed(2));var coupon_amount_str=data.cart_info.lang=='fr'?data.discount+'$':'$'+data.discount;$('.remove-coupon-code span').html(data.coupon_info.code+'('+coupon_amount_str+')');$('.remove-coupon-code').attr('data-code',data.coupon_info.code);$('#couponcode').val('');break;}}});},removeCouponCode:function(){var url='/bl_ajax/remove-coupon-code';$('.add-new-coupon-section').show();$('.remove-new-coupon-section').hide();$.getJSON(url,function(data){if(data.coupon_info==false){$('.coupon-validation-section').html('');$('#subtotal').html('$'+parseFloat(data.cart_info.total_items).toFixed(2));$('.remove-coupon-code').attr('data-code','');$('.remove-coupon-code span').html('');}});},removeFromCart:function(cart_id){var url='/bl_ajax/remove-item-from-cart/'+cart_id;$.getJSON(url,function(data){window.bl_cart.afterCartOperation(data);});},productClickedCart:function(newURL){window.location.replace(newURL);},addToCart:function(id,lensOPT,rxOPT,sunOPT){var url='/bl_ajax/add-item-to-cart/'+id+'/'+lensOPT+'/'+rxOPT+'/'+sunOPT;var is_upsell=$('#addtocart').attr('data-is-upsell');if(is_upsell!=undefined){url=(is_upsell==1)?url+'/upsell':url;}
$.getJSON(url,function(data){window.bl_cart.afterCartOperation(data);$('#bag-items').openMenu();window.gtm_analytics.myBagQuickView();});},addUpsellToCart:function(id,lensOPT,rxOPT,sunOPT){var url='/bl_ajax/add-item-to-cart/'+id+'/'+lensOPT+'/'+rxOPT+'/'+sunOPT+'/upsell';$.getJSON(url,function(data){window.bl_cart.afterCartOperation(data);$('#bag-items').openMenu();window.gtm_analytics.myBagQuickView();});},afterCartOperation:function(data){if(data.success==true){var count=data.count;BL_CART=data.cart_info;$('.bag_number_of_items').html(count.toString());var params={cart_information:data.cart_info,upsell:data.has_gotten_upsell?null:BL_UPSELL_INFO}
window.template_loader.updateLayout('cart',params,'#shopping-cart');$('#bag-items').openMenu();}
window.bl_cart.checkCartNotification();}};$(document).ready(function(){window.bl_cart.init();});