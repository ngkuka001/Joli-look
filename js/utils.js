window.debounce=function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)func.apply(context,args);};var callnow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callnow)func.apply(context,args);}};window.utils={lang:$("html").attr('class'),isValidEmailAddress:function(emailAddress){var pattern=new RegExp(/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i);return pattern.test(emailAddress);},isValidPhoneNumber:function(phoneNumber){var pattern=new RegExp(/^\(?[0-9]{3}(\-|\)) ?[0-9]{3}-[0-9]{4}$/);return pattern.test(phoneNumber);},displayErrorMessageAboveElement:function(element,errorMessage){element.before("<p id='errorContainer'>"+errorMessage+"</p>");},toggleValidityClass:function(isValid,identifier){if(isValid){$(identifier).removeClass('invalid');}
else{$(identifier).addClass('invalid');}},validateUserInput:function(contentToValidate,validationType,validationRule,elementToValidate,invalidMessage){$(elementToValidate).prev('.error').remove();var userInputValid=false;if(validationType=="string"){if(contentToValidate!==validationRule){userInputValid=true;}}else if(validationType=="email"){userInputValid=window.utils.isValidEmailAddress(contentToValidate);}else if(validationType=="confirm"){userInputValid=(contentToValidate==validationRule);}
if(userInputValid==true){window.utils.toggleValidityClass(true,elementToValidate);return true;}else{window.utils.toggleValidityClass(false,elementToValidate);var errorElement=$('<div />',{class:'error',html:invalidMessage});$(elementToValidate).before(errorElement);return false;}},detectCameraAndInit:function(){var supported=false;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;window.URL=window.URL||window.webkitURL||window.msURL||window.mozURL;if(navigator.getUserMedia){supported=true;}
return supported;},initWebcam:function(e){var myCanvas=null,ctx=null,video=null;$('.tool-container').fadeIn(250);window.URL=window.URL||window.webkitURL;navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;if(navigator.getUserMedia){var canvas=$("canvas"),cam_video=$(".cam-video"),videoObj={"video":true},errBack=function(error){window.utils.error(window.utils.t("Video capture error: ")+error.code+window.utils.t(" please notify us by sending an email to ")+'<a href="mailto:support@bonlook.com">support@bonlook.com</a>.');};myCanvas=$('#webcam-photo')[0];ctx=myCanvas.getContext("2d");video=cam_video[0];navigator.getUserMedia(videoObj,function(stream){video.src=window.URL.createObjectURL(stream);video.play();},errBack);$("#take-photo").bind("click",function(e){ctx.drawImage(video,0,0,800,600);$('.take-picture').hide();$('.save-photo').show();$('#take-photo').parent().hide();$('#retake-photo').parent().show();$('#upload-webcam-photo').parent().show();$('canvas').css({'opacity':0}).animate({'opacity':1},250);return false;});$("#retake-photo").bind("click",function(e){$('.save-photo').hide();$('.take-picture').show();$('#take-photo').parent().show();$('#retake-photo').parent().hide();$('#upload-webcam-photo').parent().hide();});}else{var submitPath=encodeURIComponent('/pdtool/upload-webcam'),callback='window.utils.flashWebcamCallback',identifier=$('.order-number').attr('value'),flashObject='';flashObject='<object  type="application/x-shockwave-flash" data="/sites/all/modules/bl_pdtool/picturething.swf" width="800" height="600">';flashObject+='<param name="FlashVars" value="submitPath='+submitPath+'&callback='+callback+'&identifier='+identifier+'">';flashObject+='</object>';$('.take-picture').html(flashObject);}},flashWebcamCallback:function(imagePath){$('.picture-wrap').html('<img src="'+imagePath+'" />');$('.take-picture').hide();$('.retake-photo').hide();$('.save-photo').fadeIn(250);this.setImageAndMethod('flashWebcam',imagePath);},error:function(msg){$(".pdtool_page").append("<p class='errorMessage'>"+msg+"</p>");var styles={"font-size":"18px","padding":"25px","color":"red"};var errorMessage=$(".errorMessage");errorMessage.css(styles);},t:function(text){var t_text=text;if(window.utils.lang=="fr"){switch(text){case"Something went wrong. Please verify that your information is correct and try again in a few seconds. You can also contact us by sending an email to ":t_text="Quelque chose n'a pas fonctionné. S.V.P. vérifiez l'information demandée et essayez de nouveau dans quelques secondes. Vous pouvez aussi nous contacter en nous envoyant un courriel à ";break;case"Video capture error: ":t_text="Erreur de capture video ";break;case" please notify us by sending an email to ":t_text=" S.V.P. nous avertir en envoyant un courriel au ";break;case"Let us know what you need":t_text="Dites-nous ce qui ne va pas";break;}}
return t_text;}};